<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <meta charset="utf-8">
    <title>myOs</title>
</head>
<body>
<div id="api">

    路径：   <input id="path0"><br>
    文件名：<input id="name0"><br>
    大小：   <input id="mem"><br>
    内容：   <input id="content"><br>
    用户：   <input id="user"><br>
    时间：   <input id="time"><br>
    <button id="build">文件写入外存</button><br>
    路径：   <input id="path1"><br>
    文件名：<input id="name1"><br>
    <button id="run">文件调入内存</button><br>
    路径：   <input id="path2"><br>
    文件名：<input id="name2"><br>
    <button id="del">文件外存删除</button><br>
    <br>
    <button id="refresh">清空系统</button><br>
</div>
<div id="direct">

</div>
<div id="inMemory">

</div>
<div id="outMemory">

</div>
<script>
    var tmp={
        "flag": "1",
        "mem" : 8,
        "address":"-1",
        "name": "file0",
        "content": "success",
        "path" : "root/child1/child2/child3/",
        "user" : "lsy",
        "time" : "1208",
    };
    let tt;
    function succ(data){
        $("#direct").html(
            data.direct.direct
        );
        let i=0,str="<pre>";
        tt=data.inMemory.inMemory;
        for(let key in data.inMemory.inMemory){
            ++i;
            str+=key+":"+data.inMemory.inMemory[key]+" ";
            if(i%8==0) str+="\n";
        }
        str+="<pre>";
        let str1="<pre>";
        for(let key in data.outMemory.outMemory){
            str1+=key+":"+data.outMemory.outMemory[key]+"\n";
        }
        str1+="<pre>";
        $("#inMemory").html(
            str
        );
        $("#outMemory").html(
            str1
        );
    }

    $("#refresh").click(function() {
        $.ajax({
            url: "/refresh",
            type: "POST",
            dataType: "json",
            data: JSON.stringify(tmp),
            contentType: "application/json;charset=utf-8",
            success: succ
        });
    });

    $("#build").click(function(){
        //后端加入文件内容
        tmp.name=$("#name0").val();
        if($("#mem").val()!="") tmp.mem=$("#mem").val();
        if($("#content").val()!="")tmp.content=$("#content").val();
        tmp.path=$("#path0").val();
        if($("#user").val()!="")tmp.user=$("#user").val();
        if($("#time").val()!="")tmp.time=$("#time").val();
        $.ajax({
            url:"/new",
            type:"POST",
            dataType:"json",
            data:JSON.stringify(tmp),
            contentType:"application/json;charset=utf-8",
            success:succ
        });
    });
    $("#del").click(function() {
        let flag=0;
        tmp.name=$("#name2").val();
        tmp.path=$("#path2").val();
        for(let key in tt){
            if(tt[key].indexOf(tmp.name)!=-1){
                flag=1;
                $("#direct").append("在内存中无法删除");
                break;
            }
        }
        if(flag==0) {
            $.ajax({
                url: "/del",
                type: "POST",
                dataType: "json",
                data: JSON.stringify(tmp),
                contentType: "application/json;charset=utf-8",
                success: succ
            });
        }
    });
    let ii=0;
    $("#run").click(function() {
        tmp.name=$("#name1").val();
        tmp.path=$("#path1").val();
        $.ajax({
            url: "/run",
            type: "POST",
            dataType: "json",
            data: JSON.stringify(tmp),
            contentType: "application/json;charset=utf-8",
        });
        for(var i=0;i<tmp.mem+1;i++) {
            setTimeout(function() {
                $.ajax({
                    url: "/get",
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify(tmp),
                    contentType: "application/json;charset=utf-8",
                    success: succ
                });
            },(++ii)*1050);
        }
    });
</script>
</body>
</html>